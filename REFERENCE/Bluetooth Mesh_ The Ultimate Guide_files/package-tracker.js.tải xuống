sndefine("mimir",["utils","browser","core-sleeknote","storage-instance","constants","consent"],(function(e,t,n,a,o,i){function r(e){var t=function(e){for(var t,n="0123456789ABCDEF",a="",o=0;o<e.length;o++)t=e.charCodeAt(o),a+=n.charAt(t>>>4&15)+n.charAt(15&t);return a}(function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}(function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,a=-271733879,o=-1732584194,i=271733878,r=0;r<e.length;r+=16){var s=n,v=a,f=o,d=i;a=m(a=m(a=m(a=m(a=g(a=g(a=g(a=g(a=l(a=l(a=l(a=l(a=c(a=c(a=c(a=c(a,o=c(o,i=c(i,n=c(n,a,o,i,e[r+0],7,-680876936),a,o,e[r+1],12,-389564586),n,a,e[r+2],17,606105819),i,n,e[r+3],22,-1044525330),o=c(o,i=c(i,n=c(n,a,o,i,e[r+4],7,-176418897),a,o,e[r+5],12,1200080426),n,a,e[r+6],17,-1473231341),i,n,e[r+7],22,-45705983),o=c(o,i=c(i,n=c(n,a,o,i,e[r+8],7,1770035416),a,o,e[r+9],12,-1958414417),n,a,e[r+10],17,-42063),i,n,e[r+11],22,-1990404162),o=c(o,i=c(i,n=c(n,a,o,i,e[r+12],7,1804603682),a,o,e[r+13],12,-40341101),n,a,e[r+14],17,-1502002290),i,n,e[r+15],22,1236535329),o=l(o,i=l(i,n=l(n,a,o,i,e[r+1],5,-165796510),a,o,e[r+6],9,-1069501632),n,a,e[r+11],14,643717713),i,n,e[r+0],20,-373897302),o=l(o,i=l(i,n=l(n,a,o,i,e[r+5],5,-701558691),a,o,e[r+10],9,38016083),n,a,e[r+15],14,-660478335),i,n,e[r+4],20,-405537848),o=l(o,i=l(i,n=l(n,a,o,i,e[r+9],5,568446438),a,o,e[r+14],9,-1019803690),n,a,e[r+3],14,-187363961),i,n,e[r+8],20,1163531501),o=l(o,i=l(i,n=l(n,a,o,i,e[r+13],5,-1444681467),a,o,e[r+2],9,-51403784),n,a,e[r+7],14,1735328473),i,n,e[r+12],20,-1926607734),o=g(o,i=g(i,n=g(n,a,o,i,e[r+5],4,-378558),a,o,e[r+8],11,-2022574463),n,a,e[r+11],16,1839030562),i,n,e[r+14],23,-35309556),o=g(o,i=g(i,n=g(n,a,o,i,e[r+1],4,-1530992060),a,o,e[r+4],11,1272893353),n,a,e[r+7],16,-155497632),i,n,e[r+10],23,-1094730640),o=g(o,i=g(i,n=g(n,a,o,i,e[r+13],4,681279174),a,o,e[r+0],11,-358537222),n,a,e[r+3],16,-722521979),i,n,e[r+6],23,76029189),o=g(o,i=g(i,n=g(n,a,o,i,e[r+9],4,-640364487),a,o,e[r+12],11,-421815835),n,a,e[r+15],16,530742520),i,n,e[r+2],23,-995338651),o=m(o,i=m(i,n=m(n,a,o,i,e[r+0],6,-198630844),a,o,e[r+7],10,1126891415),n,a,e[r+14],15,-1416354905),i,n,e[r+5],21,-57434055),o=m(o,i=m(i,n=m(n,a,o,i,e[r+12],6,1700485571),a,o,e[r+3],10,-1894986606),n,a,e[r+10],15,-1051523),i,n,e[r+1],21,-2054922799),o=m(o,i=m(i,n=m(n,a,o,i,e[r+8],6,1873313359),a,o,e[r+15],10,-30611744),n,a,e[r+6],15,-1560198380),i,n,e[r+13],21,1309151649),o=m(o,i=m(i,n=m(n,a,o,i,e[r+4],6,-145523070),a,o,e[r+11],10,-1120210379),n,a,e[r+2],15,718787259),i,n,e[r+9],21,-343485551),n=u(n,s),a=u(a,v),o=u(o,f),i=u(i,d)}return Array(n,a,o,i)}(function(e){for(var t=Array(e.length>>2),n=0;n<t.length;n++)t[n]=0;for(n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}(e),8*e.length)));return t.toLowerCase()}function s(e,t,n,a,o,i){return u(function(e,t){return e<<t|e>>>32-t}(u(u(t,e),u(a,i)),o),n)}function c(e,t,n,a,o,i,r){return s(t&n|~t&a,e,t,o,i,r)}function l(e,t,n,a,o,i,r){return s(t&a|n&~a,e,t,o,i,r)}function g(e,t,n,a,o,i,r){return s(t^n^a,e,t,o,i,r)}function m(e,t,n,a,o,i,r){return s(n^(t|~a),e,t,o,i,r)}function u(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}var v=this,f=v.document;function d(e){return e.toISOString().split(".")[0]+"Z"}function k(t,n){var a=function(e){var t=f.createElement("img");return t.width=1,t.height=1,t.src=e,t}(e.appendToUrl(t,n));a.onload=a.onerror=function(){a.onload=null,a.onerror=null}}let p=Object.create(null);function h(o,s){if(n.custom("DisableMimir"))return;Object.keys(o).forEach((e=>{void 0===o[e]&&delete o[e]}));let c=e.extend(o,function(){var n={};if(i.get("analytics")){var o=new Date,s=a.getSessionStartTime(),c=s?Math.round((o.getTime()-s.getTime())/1e3):0,l=a.getLastSessionEndTime();n.v0=r(a.getVistorId()),n.v3=d(o),s&&(n.v6=d(s)),e.empty(l)||(n.v7=d(l)),n.v20=e.empty(l)?"true":"false",n.v25=t.isLandscape()?"true":"false",n.v27=c,n.s4=v.location.href||"",n.s9=v.location.protocol||"",n.s11=v.location.pathname||"",n.s12=v.location.search||"",n.s13=v.location.hash||"",n.s2=f.title,n.c1=t.user.timezoneOffSet()||"",n.s7=t.user.language(),n.v5=t.userAgent(),n.v22=t.is.name,n.v23=t.is.version,n.v24=t.is.platform,n.v26=t.is.device}return f.referrer&&f.referrer!=v.location.href&&(n.v4=f.referrer),n.v21=a.getSessionId(),n}(),function(e){var n={};return n.s2=f.title,n.s3=v.location.hostname||"",n.s4=v.location.href||"",n.s9=v.location.protocol||"",n.s11=v.location.pathname||"",n.s12=v.location.search||"",n.s13=v.location.hash||"",n.c1=t.user.timezoneOffSet()||"",n.s7=t.user.language(),n.v5=t.userAgent(),n.v22=t.is.name,n.v23=t.is.version,n.v24=t.is.platform,n.v26=t.is.device,n}()),l=c.v1?c.v1:"event";if(p[l]||(p[l]=[]),p[l].push([c.v8,c.v9,c.v12,c.v33]),"DripOnsite"==s){let e={"3_sleeknote_shown-5_sleeknote_teaser_clicked":"manual_open","3_sleeknote_shown-4_sleeknote_trigger_manual":"manual_open","3_sleeknote_shown-13_sleeknote_trigger_click":"manual_open","3_sleeknote_shown-api":"manual_open","3_sleeknote_shown-1_sleeknote_trigger_shown_after":"auto_open","3_sleeknote_shown-2_sleeknote_trigger_scroll":"auto_open","3_sleeknote_shown-3_sleeknote_exit_intent":"auto_open","3_sleeknote_shown-14_sleeknote_trigger_sitedata":"auto_open","3_sleeknote_shown-15_embedded_campaign_show":"auto_open","5_sleeknote_closed-8_sleeknote_closebutton_clicked":"manual_close","5_sleeknote_closed-9_sleeknote_dismissed":"manual_close","5_sleeknote_closed-12_sleeknote_linkbutton_clicked":"manual_close","4_sleeknote_engaged-6_sleeknote_submitbutton_clicked":"submit","4_sleeknote_engaged-":"submit"}[[c.v8,c.v9].join("-")];e&&v._dcq&&v._dcq.push(["trackFormEvent",{formId:o.v1,action:e,properties:o}])}else k("https://analytics.sleeknote.com/",function(t){var n="";return t&&(n=Object.keys(t).map((function(n){return e.urlencode(n)+"="+e.urlencode(t[n])})).join("&")),n}(c))}function S(){}return n.expose(p,"mimir"),S.prototype={trackPageView:function(){h({s1:v.SleekNote&&v.SleekNote.CustomerId||0,v8:o.MIMIR.EVENTS[v.performance&&1==v.performance.navigation.type?"PAGERELOAD":"PAGEVIEW"]||"pageview"})},extractFromNoteConfig:function(e){return{campaignId:e.config.campaignId,stepName:e.config.name,position:e.config.position,customerId:e.config.customerId,type:e.campaign.config.type,summaryId:e.campaign.config.summaryId,splitTestId:e.campaign.config.splitTestId,smartIndex:e.campaign.config.smartIndex,NS:e.config.NS}},trackNoteEvent:function(e,{eventName:t,triggerName:n,triggerValue:a,linkDestination:r,linkType:s,linkDestinationType:c,linkName:l,elementDataId:g}){if(t){let e=o.MIMIR.EVENTS[t.toUpperCase()];e&&(t=e)}if(n){let e=o.MIMIR.TRIGGERS[n.toUpperCase()];e&&(n=e)}let{campaignId:m,type:u,stepName:v,position:f,customerId:d,summaryId:k,splitTestId:p,smartIndex:S,NS:E}=this.extractFromNoteConfig(e);if(u){let e=o.MIMIR.NOTES[u.toUpperCase()];e&&(u=e)}let _={s1:d,v1:m,v8:t,v9:n,v10:a,v12:u,v34:k};i.get("analytics")&&(_={..._,v11:new Boolean(S).toString(),v13:f,v19:p&&!isNaN(p)?p:void 0,v28:r,v29:s,v30:c,v31:l,v32:g,v33:v}),/*!triggerMapping[triggerName] ||*/t&&u?h(_,E):console.warn("trackNoteEvent failed:",t,n,u)},trackGoal:function(e,t){const n=v.SleekNote;if(!n||!n.SleeknoteGoals)return;if(e){let t=o.MIMIR.EVENTS[e.toUpperCase()];t&&(e=t)}let i=n.CustomerId;i&&(h({s1:i,v8:e,g1:t,v15:"true",g2:Object.keys(a.getGoalEngageList()).join(","),g3:Object.keys(a.getGoalShownList()).join(",")}),a.resetGoal())}},S})),sndefine("session-tracker",["utils","storage-instance","global"],(function(e,t,n){var a=this.document,o=1800;function i(){t.startSessionTime()}var r=0,s=6e4,c=e.throttle(6e4,(function(){v("activity")}));function l(){r&&(n.clearInterval(r),r=0,t.endSessionTime())}function g(){i(),r||(r=n.setInterval(u,s))}function m(e){switch(e){case"newSession":g();break;case"newSessionIf":r||(i(),r=n.setInterval(u,s));break;case"endSession":l();break;case"restartSession":l(),g()}t.write("timestamp",(new Date).getTime())}function u(){v("interval")}function v(e){var n=(new Date).getTime(),a=+t.read("timestamp")||n;if(Math.max(Math.floor((n-a)/1e3),0)>=o)switch(e){case"start":case"activity":m("restartSession");break;case"interval":m("endSession")}else switch(e){case"activity":m("newSessionIf");break;case"start":t.read("timestamp")?m("newSessionIf"):m("newSession")}}return e.listener(a,"add",c)("click")("mousemove")("keypress"),e.listener(this,"add",c)("load"),r=n.setInterval(u,s),v("start"),!0})),sndefine("tracker",["utils","core-sleeknote","mimir","location","storage-instance","constants","logger","session-tracker","global"],(function(e,t,n,a,o,i,r,s,c){var l=this,g=l.document,m=r.log(i.CORE.LOGLEVELS.TRACKER,i.CORE.FORMATTERS.CORE);let u=i.CORE.COMMANDS,v=i.MIMIR.EVENTS,f=i.MIMIR.TRIGGERS;function d(e,n,a){if(t.custom("DisableGA"))m("GA disabled in config",t.custom("DisableGA"));else if(!t.custom("DisableGAEvents")||!~t.custom("DisableGAEvents").indexOf(n)){var o=l.ga,i=l._gat,r=l._gaq,s=l.__gaTracker,c=l.gtag,g=0;try{if(a=a.toString(),i&&i._getTrackers?(i._getTrackers().forEach((function(t){t._trackEvent(e,n,a,void 0,1)})),g++):r&&r.push?r.push(["_trackEvent",e,n,a,void 0,1]):s&&s("send","event",e,n,a,void 0,1),o&&o.getAll){var u=[];o.getAll().forEach((function(t){var i=t.get("trackingId");~u.indexOf(i)||(u.push(i),o(t.get("name")+".send","event",e,n,a,{nonInteraction:!0}))})),g++}c&&(c("event",n,{event_category:e,event_label:a,non_interaction:!0}),g++),g||m("google blocked")}catch(e){m(e)}}}const k=new c.Set;return t.expose(t.preview?{trackPageView:()=>{}}:new class{constructor(){this.mimirTracker=new n,g.addEventListener(t.eventName,this);g.addEventListener("sleekNote",(()=>{this.isGoalMatch(),l.SleekNote&&l.SleekNote.SleeknoteGoals&&(l.SleekNote.trackGoal=e=>{this.mimirTracker.trackGoal(v.GOAL_CONVERTED,e)})}),{once:!0})}trackPageView(e){if("SleekNote"==e)return this.mimirTracker.trackPageView(),this.mimirTracker.trackPageView=()=>{},!0}handleEvent(t){let{creator:n}=t.data;if(n==i.CORE.CREATOR.USER){let{command:n,eventTarget:a,origin:i,campaignId:r,formData:s,eventType:c}=t.data,l=e.contains(i.campaign.config.type,"promote","guide"),g=i.campaign.config.type;switch(l&&(g="blank"),n){case u.OPEN:{let e=i.config.type;"teaser"==e&&this.event(i,{eventName:v.SHOWN,triggerName:f.TEASERCLICK,eventTarget:a}),"form"==e&&this.event(i,{eventName:v.CLOSED,eventTarget:a})}break;case u.CLOSE:{let e=i.config.type,t=v.CLOSED;"teaser"==e&&(t=v.TEASER_CLOSED),t&&this.event(i,{eventName:t,eventTarget:a})}break;case u.SUBMIT:{this.sendSleeknoteEventToTrackers(g,i.campaign.config);let n=o.hasConvertSessionEvent(r);if("quiz"==i.campaign.config.campaignType&&t.data.formElements.email&&!t.data.email||!l&&!s||l&&this.hasConvertSessionEvent(r)&&s)return void console.log("trackEventSkip");let a=v.ENGAGED;n&&i.campaign.getType("form").length>1&&(a=v.SUBSTEP_ENGAGED),this.event(i,{eventName:a,triggerName:e.contains(c,"keypress")?f.KEYPRESSSUBMIT:f.MOUSESUBMIT}),this.sendAdditionalEventDataToTracker(i),o.convertSessionEvent(r)}break;case u.CLICK:let n={eventName:v.LINK_CLICKED,eventTarget:a,href:t.data.href,step:t.data.step,target:t.data.target};this.event(i,n),l&&!k.has(r)&&(n.eventName=v.ENGAGED,this.event(i,n),this.sendSleeknoteEventToTrackers(g,i.campaign.config),k.add(r))}}else if(n==i.CORE.CREATOR.API){let{origin:n,trigger:a,command:o}=t.data;if(e.contains(a,"none","submit")||o==u.CLOSE)return;if("queue"==a)return;"auto"==a&&"EmbeddedNote"==n.kind&&(a=f.EMBEDDED),this.event(n,{eventName:v.SHOWN,triggerName:a})}}event(e,t){if(!e||!t)return;let{eventTarget:n,href:a,step:o,elementDataId:i}=t;switch(n&&!i&&(t.elementDataId=n.getAttribute("data-track-id")||n.getAttribute("data-id")),t.eventName){case v.SHOWN:switch(t.triggerName){case f.TIMER:t.value=e.config.wait/1e3;break;case f.SCROLL:t.value=e.config.scroll}break;case v.ENGAGED:case v.LINK_CLICKED:if(a||o){if(!n)return;let e="IMG"==n.nodeName,i=n.classList.contains("linkbutton");t={...t,linkDestination:a||o,linkDestinationType:a?"1_url":"2_sleeknotestep",linkType:e?"1_imagelink":i?"3_linkbutton":"2_textlink",linkName:n.innerText}}break;case v.TEASER_CLOSED:t.triggerName=f.TEASERCLOSE;break;case v.CLOSED:let i=n?f.CLOSEBUTTON:f.DISMISS;i==f.CLOSEBUTTON&&n.classList.contains("linkbutton")&&(i=f.LINKBUTTON),t.triggerName=i}this.mimirTracker.trackNoteEvent(e,t),t.eventName==v.SHOWN&&this.sendSleeknoteEventToTrackers("boxShown",e.config)}cohortEvent(e,t,n){d("cohorts",e,t+" | "+n)}sendSleeknoteEventToTrackers(e,t){let n={boxShown:"Sleeknote shown,Onsite campaign shown",newsletter:"New Subscriber,New email subscriber",contact:"New contact request,New connect event",blank:"Blank Click,Onsite campaign engaged"};function a(e){return e.split(",")["SleekNote"==t.NS?0:1]}e in n&&(m("sendEventToTrackers",e),d(a("Sleeknote,Drip Opt-in Form"),a(n[e]),t.campaignId))}isGoalMatch(){const e=l.SleekNote&&l.SleekNote.SleeknoteGoals;if(e){var n=g.location.href,i=a.get(t).host.split(".");i.length>2&&(i.shift(),n=n.replace(a.get(t).host,i.join(".")));var r,s,c,m=o.read("location");if(m.a=m.a||{},m.a.l!=n)for(m.a.l=n,o.write("location",m),r=0;r<e.length;r++)for(c=e[r].urls,s=0;s<c.length;s++)if(~n.indexOf(c[s].url)){this.mimirTracker.trackGoal(v.GOAL_CONVERTED,e[r].goalId);break}}}sendAdditionalEventDataToTracker(n){let o=n.config.NS,i={campaignName:t.getCampaignName(n.config),["SleekNote"==o?"SleeknoteId":"OnsiteCampaignId"]:n.config.campaignId,SignupPage:a.get(t).href,event:"SleekNote"==o?"SleeknoteSubscriber":"New email subscriber",fieldData:e.parseForm(n.config.formNode,void 0,!0)};"SleekNote"==o&&(i.CustomerId=n.config.customerId);try{let n=l.top,a=n.dataLayer||n[t.custom("googleDataLayerObjectName")];Array.isArray(a)&&a.push(e.extend(i)),i.fieldData&&delete i.fieldData,delete i.SignupPage;var r=n.fbq||n[t.custom("fbqDataLayerObjectName")];e.isFunction(r)&&r("trackCustom",i.event,i)}catch(e){console.warn(e)}}},"tracker")})),sndefine("package-tracker",["tracker"],(function(e){return e}));